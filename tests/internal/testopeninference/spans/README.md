# OpenInference Span Files

This directory contains pre-recorded OpenTelemetry spans for OpenAPI chat
completion requests from [testopenai](../../testopenai/cassettes).

## Span Structure

Each file contains a single `opentelemetry.proto.trace.v1.Span` message,
generated by the OpenInference Python OpenAI instrumentation.

This follows their [semantic conventions][openinference-semconv].
- **name**: Operation name (e.g., "ChatCompletion")
- **kind**: Always `SPAN_KIND_INTERNAL` for OpenInference
- **attributes**: Key-value pairs following [OpenInference semantic conventions](https://github.com/Arize-ai/openinference/blob/main/spec/semantic_conventions.md)
- **status**: Success or error status
- **events**: Exception events for error cases

### Span Comparison

When recording spans, volatile fields like `span_id`, `trace_id`, and
timestamps are cleared. This allows idempotent recording when the OpenInference
python instrumentation hasn't changed.

When comparing with spans created by Envoy AI Gateway, attributes are compared
leniently, allowing serialization differences between Python and Go. This is
handled in [assertions.go](../assertions.go) `RequireSpanEqual`.

## Regenerating Spans

Recording scenarios and instructions are provided in the
[Parent README](../README.md).

---

[json-protobuf]: https://opentelemetry.io/docs/specs/otlp/#json-protobuf-encoding
[openinference-semconv]: https://github.com/Arize-ai/openinference/blob/main/spec/semantic_conventions.md
